var cfg = require('config');
var mailer = require('nodemailer');
var xpress = require('express');
var router = xpress.Router();

//route pour envoyer l'email
router.get("/email.html", function(req, resp){

    //Pour la connexion au serveur SMTP qui s'occupe de l'envoie des mails
    //createTransport cree la connexion
    // %40 = @
    //Avant LE :// c'est le protocoale de communication ici c'est le SMTP
    //C'est la langue dans laquel les ordi ce parle entre eux
    //A la fin l'adresse du serveur pour si connecter
    var transporter = mailer.createTransport('smtps://'+cfg.MAIL.smtpuser+'%40gmail.com:'+cfg.MAIL.smtppassword+'@smtp.gmail.com');
    var mailoptions ={
            //l'envoyeur
            from :"cyril.maipee@gmail.com",
            //recever
            to :"cyril.maipee@gmail.com",
            //sujet du message
            Subject :"Hello from Node JS",
            //format texte
            text :"Bonjour, tout le monde",
            //format html
            html :"<p>Bonjour, tout le monde </p>"
            //option obligatoire sinon il ne marche pas
    }
    transporter.sendMail(mailoptions,function(err,info){
        //si j'ai une erreur je l'ecris dans la console le return permet de sortir de la fonction et de ne pas afficher le suivant
        if(err) return console.log(err);

        console.log('Message bien envoy√©'); 

    });
    //on ferme la connexion smtp
    transporter.close();
    resp.status(200).end();
});

module.exports=router;